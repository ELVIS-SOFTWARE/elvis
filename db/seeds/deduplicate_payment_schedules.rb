#Procédure rails de déduplication d'échéanciers:
#Prendre tous les échéanciers en double(ou triple ou...) pour une même saison et un même utilisateur
#Ne garder qu'un échéancier, en mettant les échéances et commentaires des autres dans celui qu'on garde.
#Supprimer les autres échéanciers.

save = []
keeps = []

payment_schedules = []
due_payments = {}
payments = {}

PaymentSchedule.transaction do
  PaymentSchedule.all.group_by { |s| [s.payable_id, s.payable_type, s.season_id] }.select { |k, v| !k.include?("Contact") && v.count > 1 }.each do |_k, v|

    to_keep = v.max_by do |ps|
      a = ps.due_payments.max_by(&:updated_at)&.updated_at

      if a.nil?
        ps.updated_at
      else
       [ps.updated_at, a].max
      end
    end

    keeps << to_keep

    to_delete = v.drop(1)

    to_delete.each do |td|
      save << td
      payment_schedules << td

      due_payments[td.id] = td.due_payments
      td.due_payments&.each { |d| payments[d.id] = d.payments }

    end
  end
end

# à ne faire que pour clean les payment orphelin
pd = []
Payment.all.each do |p|
  pd << p if p.due_payment_id.zero? || p.due_payment.nil?
end

# # ----- correction payment_schedules -------
# schedules = JSON.parse('[{"id":3290,"payable_id":6644,"created_at":"2021-07-08T11:18:34.933+02:00","updated_at":"2021-07-08T11:18:34.933+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1},{"id":3291,"payable_id":6644,"created_at":"2021-07-08T11:18:56.392+02:00","updated_at":"2021-07-08T11:18:56.392+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1},{"id":3294,"payable_id":4327,"created_at":"2021-07-08T14:45:08.843+02:00","updated_at":"2021-07-08T14:45:08.843+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1},{"id":3292,"payable_id":4327,"created_at":"2021-07-08T14:37:32.444+02:00","updated_at":"2021-07-08T14:49:07.224+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3309,"payable_id":4020,"created_at":"2021-07-09T10:09:28.749+02:00","updated_at":"2021-07-09T10:09:28.749+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1},{"id":3311,"payable_id":4950,"created_at":"2021-07-09T14:13:55.149+02:00","updated_at":"2021-07-09T14:23:02.150+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3353,"payable_id":7053,"created_at":"2021-07-15T10:39:05.870+02:00","updated_at":"2021-07-15T10:51:42.670+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3358,"payable_id":6868,"created_at":"2021-07-15T15:59:13.315+02:00","updated_at":"2021-07-15T16:04:03.047+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3361,"payable_id":7046,"created_at":"2021-07-15T17:31:03.619+02:00","updated_at":"2021-07-15T17:33:43.218+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3377,"payable_id":6879,"created_at":"2021-07-16T15:05:21.187+02:00","updated_at":"2021-07-16T15:13:27.790+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3490,"payable_id":7306,"created_at":"2021-09-01T11:47:45.976+02:00","updated_at":"2021-09-01T11:47:45.976+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1},{"id":3491,"payable_id":7306,"created_at":"2021-09-01T11:50:16.518+02:00","updated_at":"2021-09-01T11:50:16.518+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1},{"id":3501,"payable_id":5697,"created_at":"2021-09-01T16:46:28.632+02:00","updated_at":"2021-09-01T16:46:28.632+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1},{"id":3502,"payable_id":5697,"created_at":"2021-09-01T16:46:44.619+02:00","updated_at":"2021-09-01T16:47:29.002+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3504,"payable_id":6836,"created_at":"2021-09-01T17:26:10.917+02:00","updated_at":"2021-09-01T17:38:35.475+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3511,"payable_id":6419,"created_at":"2021-09-02T14:54:43.665+02:00","updated_at":"2021-09-02T14:54:43.665+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1},{"id":3522,"payable_id":6963,"created_at":"2021-09-03T17:51:31.837+02:00","updated_at":"2021-09-03T17:52:06.107+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3628,"payable_id":7185,"created_at":"2021-09-14T18:10:17.409+02:00","updated_at":"2021-09-14T18:10:29.533+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":2},{"id":3711,"payable_id":7146,"created_at":"2021-09-20T18:32:12.543+02:00","updated_at":"2021-09-20T18:32:12.543+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1},{"id":3712,"payable_id":7146,"created_at":"2021-09-20T18:32:42.480+02:00","updated_at":"2021-09-20T18:32:42.480+02:00","payable_type":"User","location_id":null,"season_id":5,"payment_schedule_status_id":1}]')
# payments_schedules = []
# schedules.each do |s|
#   payments_schedules << PaymentSchedule.new(s)
# end
#
# PaymentSchedule.transaction do
#   payments_schedules.each(&:save)
# end
#
# # ------ correction due_payments --------
# dues = JSON.parse('{"3290":[],"3291":[],"3294":[],"3292":[{"id":17727,"payment_schedule_id":3292,"number":0,"previsional_date":"2021-10-05","amount":"15.0","created_at":"2021-07-08T14:45:51.525+02:00","updated_at":"2021-07-08T14:45:51.525+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17728,"payment_schedule_id":3292,"number":1,"previsional_date":"2021-10-05","amount":"148.0","created_at":"2021-07-08T14:45:51.540+02:00","updated_at":"2021-07-08T14:45:51.540+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17729,"payment_schedule_id":3292,"number":2,"previsional_date":"2022-01-05","amount":"163.0","created_at":"2021-07-08T14:45:51.559+02:00","updated_at":"2021-07-08T14:45:51.559+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17730,"payment_schedule_id":3292,"number":3,"previsional_date":"2022-04-05","amount":"163.0","created_at":"2021-07-08T14:45:51.576+02:00","updated_at":"2021-07-08T14:45:51.576+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3309":[{"id":18163,"payment_schedule_id":3309,"number":0,"previsional_date":"2021-10-15","amount":"15.0","created_at":"2021-07-16T11:25:32.908+02:00","updated_at":"2021-07-16T11:25:32.908+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18164,"payment_schedule_id":3309,"number":1,"previsional_date":"2021-10-15","amount":"148.0","created_at":"2021-07-16T11:25:32.927+02:00","updated_at":"2021-07-16T11:25:32.927+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18165,"payment_schedule_id":3309,"number":2,"previsional_date":"2022-01-15","amount":"163.0","created_at":"2021-07-16T11:25:32.946+02:00","updated_at":"2021-07-16T11:25:32.946+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18166,"payment_schedule_id":3309,"number":3,"previsional_date":"2022-04-15","amount":"163.0","created_at":"2021-07-16T11:25:32.964+02:00","updated_at":"2021-07-16T11:25:32.964+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3311":[{"id":17809,"payment_schedule_id":3311,"number":1,"previsional_date":"2021-09-05","amount":"36.5","created_at":"2021-07-09T14:22:53.472+02:00","updated_at":"2021-09-10T16:48:42.177+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17810,"payment_schedule_id":3311,"number":2,"previsional_date":"2021-10-05","amount":"51.5","created_at":"2021-07-09T14:22:53.485+02:00","updated_at":"2021-07-09T14:22:53.485+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17811,"payment_schedule_id":3311,"number":3,"previsional_date":"2021-11-05","amount":"51.5","created_at":"2021-07-09T14:22:53.498+02:00","updated_at":"2021-07-09T14:22:53.498+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17812,"payment_schedule_id":3311,"number":4,"previsional_date":"2021-12-05","amount":"51.5","created_at":"2021-07-09T14:22:53.513+02:00","updated_at":"2021-07-09T14:22:53.513+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17813,"payment_schedule_id":3311,"number":5,"previsional_date":"2022-01-05","amount":"51.5","created_at":"2021-07-09T14:22:53.526+02:00","updated_at":"2021-07-09T14:22:53.526+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17814,"payment_schedule_id":3311,"number":6,"previsional_date":"2022-02-05","amount":"51.5","created_at":"2021-07-09T14:22:53.538+02:00","updated_at":"2021-07-09T14:22:53.538+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17815,"payment_schedule_id":3311,"number":7,"previsional_date":"2022-03-05","amount":"51.5","created_at":"2021-07-09T14:22:53.551+02:00","updated_at":"2021-07-09T14:22:53.551+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17816,"payment_schedule_id":3311,"number":8,"previsional_date":"2022-04-05","amount":"51.5","created_at":"2021-07-09T14:22:53.566+02:00","updated_at":"2021-07-09T14:22:53.566+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17817,"payment_schedule_id":3311,"number":9,"previsional_date":"2022-05-05","amount":"51.5","created_at":"2021-07-09T14:22:53.580+02:00","updated_at":"2021-07-09T14:22:53.580+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17818,"payment_schedule_id":3311,"number":10,"previsional_date":"2022-06-05","amount":"51.5","created_at":"2021-07-09T14:22:53.594+02:00","updated_at":"2021-07-09T14:22:53.594+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":17808,"payment_schedule_id":3311,"number":0,"previsional_date":"2021-09-05","amount":"15.0","created_at":"2021-07-09T14:22:53.458+02:00","updated_at":"2021-09-10T16:48:42.190+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3353":[{"id":18024,"payment_schedule_id":3353,"number":5,"previsional_date":"2022-01-05","amount":"38.0","created_at":"2021-07-15T10:39:49.713+02:00","updated_at":"2021-07-16T13:49:26.861+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18027,"payment_schedule_id":3353,"number":8,"previsional_date":"2022-04-05","amount":"38.0","created_at":"2021-07-15T10:39:49.751+02:00","updated_at":"2021-07-16T13:49:43.116+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18028,"payment_schedule_id":3353,"number":9,"previsional_date":"2022-05-05","amount":"38.0","created_at":"2021-07-15T10:39:49.765+02:00","updated_at":"2021-07-16T13:49:49.932+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18029,"payment_schedule_id":3353,"number":10,"previsional_date":"2022-06-05","amount":"38.0","created_at":"2021-07-15T10:39:49.780+02:00","updated_at":"2021-07-16T13:49:55.234+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18026,"payment_schedule_id":3353,"number":7,"previsional_date":"2022-03-05","amount":"38.0","created_at":"2021-07-15T10:39:49.737+02:00","updated_at":"2021-07-16T13:49:37.871+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18021,"payment_schedule_id":3353,"number":2,"previsional_date":"2021-10-05","amount":"38.0","created_at":"2021-07-15T10:39:49.674+02:00","updated_at":"2021-07-15T10:48:51.642+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18022,"payment_schedule_id":3353,"number":3,"previsional_date":"2021-11-05","amount":"38.0","created_at":"2021-07-15T10:39:49.688+02:00","updated_at":"2021-07-15T10:49:04.622+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18023,"payment_schedule_id":3353,"number":4,"previsional_date":"2021-12-05","amount":"38.0","created_at":"2021-07-15T10:39:49.701+02:00","updated_at":"2021-07-15T10:50:15.359+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18019,"payment_schedule_id":3353,"number":0,"previsional_date":"2021-07-15","amount":"15.0","created_at":"2021-07-15T10:39:49.647+02:00","updated_at":"2021-07-15T10:51:22.266+02:00","payment_method_id":8,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18025,"payment_schedule_id":3353,"number":6,"previsional_date":"2022-02-05","amount":"38.0","created_at":"2021-07-15T10:39:49.725+02:00","updated_at":"2021-07-16T13:49:32.505+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18020,"payment_schedule_id":3353,"number":1,"previsional_date":"2021-09-05","amount":"38.0","created_at":"2021-07-15T10:39:49.661+02:00","updated_at":"2021-07-15T10:48:03.910+02:00","payment_method_id":6,"due_payment_status_id":5,"location_id":null,"operation":"+"}],"3358":[{"id":18078,"payment_schedule_id":3358,"number":0,"previsional_date":"2021-10-05","amount":"15.0","created_at":"2021-07-15T15:59:13.319+02:00","updated_at":"2021-07-15T15:59:13.319+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18079,"payment_schedule_id":3358,"number":1,"previsional_date":"2021-10-05","amount":"148.0","created_at":"2021-07-15T15:59:13.322+02:00","updated_at":"2021-07-15T15:59:13.322+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18080,"payment_schedule_id":3358,"number":2,"previsional_date":"2022-01-05","amount":"163.0","created_at":"2021-07-15T15:59:13.324+02:00","updated_at":"2021-07-15T15:59:13.324+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18081,"payment_schedule_id":3358,"number":3,"previsional_date":"2022-04-05","amount":"163.0","created_at":"2021-07-15T15:59:13.328+02:00","updated_at":"2021-07-15T15:59:13.328+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3361":[{"id":18088,"payment_schedule_id":3361,"number":0,"previsional_date":"2021-10-05","amount":"15.0","created_at":"2021-07-15T17:31:25.980+02:00","updated_at":"2021-07-15T17:31:25.980+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18089,"payment_schedule_id":3361,"number":1,"previsional_date":"2021-10-05","amount":"148.0","created_at":"2021-07-15T17:31:26.006+02:00","updated_at":"2021-07-15T17:31:26.006+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18090,"payment_schedule_id":3361,"number":2,"previsional_date":"2022-01-05","amount":"163.0","created_at":"2021-07-15T17:31:26.023+02:00","updated_at":"2021-07-15T17:31:26.023+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18091,"payment_schedule_id":3361,"number":3,"previsional_date":"2022-04-05","amount":"163.0","created_at":"2021-07-15T17:31:26.038+02:00","updated_at":"2021-07-15T17:31:26.038+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3377":[{"id":18185,"payment_schedule_id":3377,"number":3,"previsional_date":"2021-10-15","amount":"34.5","created_at":"2021-07-16T15:05:21.203+02:00","updated_at":"2021-07-16T15:05:21.203+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18183,"payment_schedule_id":3377,"number":0,"previsional_date":"2021-09-15","amount":"15.0","created_at":"2021-07-16T15:05:21.194+02:00","updated_at":"2021-09-15T02:00:18.874+02:00","payment_method_id":6,"due_payment_status_id":5,"location_id":null,"operation":"+"},{"id":18186,"payment_schedule_id":3377,"number":4,"previsional_date":"2021-11-15","amount":"34.5","created_at":"2021-07-16T15:05:21.206+02:00","updated_at":"2021-07-16T15:05:21.206+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18187,"payment_schedule_id":3377,"number":5,"previsional_date":"2021-12-15","amount":"34.5","created_at":"2021-07-16T15:05:21.209+02:00","updated_at":"2021-07-16T15:05:21.209+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18188,"payment_schedule_id":3377,"number":6,"previsional_date":"2022-01-15","amount":"34.5","created_at":"2021-07-16T15:05:21.211+02:00","updated_at":"2021-07-16T15:05:21.211+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18189,"payment_schedule_id":3377,"number":7,"previsional_date":"2022-02-15","amount":"34.5","created_at":"2021-07-16T15:05:21.213+02:00","updated_at":"2021-07-16T15:05:21.213+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18190,"payment_schedule_id":3377,"number":8,"previsional_date":"2022-03-15","amount":"34.5","created_at":"2021-07-16T15:05:21.216+02:00","updated_at":"2021-07-16T15:05:21.216+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18191,"payment_schedule_id":3377,"number":9,"previsional_date":"2022-04-15","amount":"34.5","created_at":"2021-07-16T15:05:21.218+02:00","updated_at":"2021-07-16T15:05:21.218+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18184,"payment_schedule_id":3377,"number":2,"previsional_date":"2021-09-15","amount":"19.5","created_at":"2021-07-16T15:05:21.199+02:00","updated_at":"2021-09-15T02:00:18.879+02:00","payment_method_id":6,"due_payment_status_id":5,"location_id":null,"operation":"+"},{"id":18192,"payment_schedule_id":3377,"number":10,"previsional_date":"2022-05-15","amount":"34.5","created_at":"2021-07-16T15:05:21.221+02:00","updated_at":"2021-07-16T15:05:21.221+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18193,"payment_schedule_id":3377,"number":11,"previsional_date":"2022-06-15","amount":"34.5","created_at":"2021-07-16T15:05:21.223+02:00","updated_at":"2021-07-16T15:05:21.223+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18194,"payment_schedule_id":3377,"number":12,"previsional_date":"2021-09-01","amount":"80.0","created_at":"2021-07-16T15:06:40.113+02:00","updated_at":"2021-07-16T15:06:40.113+02:00","payment_method_id":7,"due_payment_status_id":5,"location_id":null,"operation":"+"}],"3490":[],"3491":[{"id":18815,"payment_schedule_id":3491,"number":0,"previsional_date":"2021-10-05","amount":"15.0","created_at":"2021-09-01T11:50:16.522+02:00","updated_at":"2021-09-01T11:50:16.522+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18816,"payment_schedule_id":3491,"number":1,"previsional_date":"2021-10-05","amount":"24.5","created_at":"2021-09-01T11:50:16.528+02:00","updated_at":"2021-09-01T11:50:16.528+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18817,"payment_schedule_id":3491,"number":2,"previsional_date":"2021-11-05","amount":"39.5","created_at":"2021-09-01T11:50:16.537+02:00","updated_at":"2021-09-01T11:50:16.537+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18818,"payment_schedule_id":3491,"number":3,"previsional_date":"2021-12-05","amount":"39.5","created_at":"2021-09-01T11:50:16.540+02:00","updated_at":"2021-09-01T11:50:16.540+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18819,"payment_schedule_id":3491,"number":4,"previsional_date":"2022-01-05","amount":"39.5","created_at":"2021-09-01T11:50:16.543+02:00","updated_at":"2021-09-01T11:50:16.543+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18820,"payment_schedule_id":3491,"number":5,"previsional_date":"2022-02-05","amount":"39.5","created_at":"2021-09-01T11:50:16.546+02:00","updated_at":"2021-09-01T11:50:16.546+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18821,"payment_schedule_id":3491,"number":6,"previsional_date":"2022-03-05","amount":"39.5","created_at":"2021-09-01T11:50:16.549+02:00","updated_at":"2021-09-01T11:50:16.549+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18822,"payment_schedule_id":3491,"number":7,"previsional_date":"2022-04-05","amount":"39.5","created_at":"2021-09-01T11:50:16.551+02:00","updated_at":"2021-09-01T11:50:16.551+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18823,"payment_schedule_id":3491,"number":8,"previsional_date":"2022-05-05","amount":"39.5","created_at":"2021-09-01T11:50:16.555+02:00","updated_at":"2021-09-01T11:50:16.555+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18824,"payment_schedule_id":3491,"number":9,"previsional_date":"2022-06-05","amount":"39.5","created_at":"2021-09-01T11:50:16.558+02:00","updated_at":"2021-09-01T11:50:16.558+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18825,"payment_schedule_id":3491,"number":10,"previsional_date":"2022-07-05","amount":"39.5","created_at":"2021-09-01T11:50:16.561+02:00","updated_at":"2021-09-01T11:50:16.561+02:00","payment_method_id":6,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3501":[],"3502":[{"id":18867,"payment_schedule_id":3502,"number":0,"previsional_date":"2021-09-01","amount":"15.0","created_at":"2021-09-01T16:46:44.623+02:00","updated_at":"2021-09-01T16:46:52.987+02:00","payment_method_id":8,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18868,"payment_schedule_id":3502,"number":1,"previsional_date":"2021-09-01","amount":"452.0","created_at":"2021-09-01T16:46:44.629+02:00","updated_at":"2021-09-01T16:46:53.014+02:00","payment_method_id":8,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3504":[{"id":18871,"payment_schedule_id":3504,"number":1,"previsional_date":"2021-10-05","amount":"345.0","created_at":"2021-09-01T17:26:10.936+02:00","updated_at":"2021-09-01T17:27:22.342+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18872,"payment_schedule_id":3504,"number":0,"previsional_date":"2021-10-05","amount":"30.0","created_at":"2021-09-01T17:26:35.143+02:00","updated_at":"2021-09-01T17:37:29.452+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3511":[{"id":18885,"payment_schedule_id":3511,"number":0,"previsional_date":"2021-09-05","amount":"15.0","created_at":"2021-09-02T14:54:43.668+02:00","updated_at":"2021-09-02T14:54:43.668+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18886,"payment_schedule_id":3511,"number":2,"previsional_date":"2021-09-05","amount":"361.6","created_at":"2021-09-02T14:54:43.671+02:00","updated_at":"2021-09-02T14:54:55.052+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18887,"payment_schedule_id":3511,"number":3,"previsional_date":"2021-09-01","amount":"90.4","created_at":"2021-09-02T14:55:19.054+02:00","updated_at":"2021-09-02T14:55:32.804+02:00","payment_method_id":5,"due_payment_status_id":5,"location_id":null,"operation":"+"}],"3522":[{"id":18924,"payment_schedule_id":3522,"number":0,"previsional_date":"2021-10-05","amount":"15.0","created_at":"2021-09-03T17:51:31.843+02:00","updated_at":"2021-09-03T17:51:31.843+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":18925,"payment_schedule_id":3522,"number":1,"previsional_date":"2021-10-05","amount":"90.0","created_at":"2021-09-03T17:51:31.849+02:00","updated_at":"2021-09-03T17:51:31.849+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3628":[{"id":19542,"payment_schedule_id":3628,"number":2,"previsional_date":"2021-09-14","amount":"289.0","created_at":"2021-09-14T18:27:50.686+02:00","updated_at":"2021-09-14T18:31:42.020+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19540,"payment_schedule_id":3628,"number":0,"previsional_date":"2021-09-14","amount":"15.0","created_at":"2021-09-14T18:27:50.658+02:00","updated_at":"2021-09-14T18:28:17.270+02:00","payment_method_id":8,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19541,"payment_schedule_id":3628,"number":1,"previsional_date":"2021-09-14","amount":"163.0","created_at":"2021-09-14T18:27:50.674+02:00","updated_at":"2021-09-14T18:28:17.300+02:00","payment_method_id":2,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3711":[{"id":19986,"payment_schedule_id":3711,"number":1,"previsional_date":"2021-09-05","amount":"50.0","created_at":"2021-09-20T18:32:12.547+02:00","updated_at":"2021-09-20T18:32:12.547+02:00","payment_method_id":0,"due_payment_status_id":5,"location_id":null,"operation":"+"},{"id":19987,"payment_schedule_id":3711,"number":2,"previsional_date":"2021-10-05","amount":"50.0","created_at":"2021-09-20T18:32:12.555+02:00","updated_at":"2021-09-20T18:32:12.555+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19988,"payment_schedule_id":3711,"number":3,"previsional_date":"2021-11-05","amount":"50.0","created_at":"2021-09-20T18:32:12.559+02:00","updated_at":"2021-09-20T18:32:12.559+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19989,"payment_schedule_id":3711,"number":4,"previsional_date":"2021-12-05","amount":"50.0","created_at":"2021-09-20T18:32:12.562+02:00","updated_at":"2021-09-20T18:32:12.562+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19990,"payment_schedule_id":3711,"number":5,"previsional_date":"2022-01-05","amount":"50.0","created_at":"2021-09-20T18:32:12.565+02:00","updated_at":"2021-09-20T18:32:12.565+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19991,"payment_schedule_id":3711,"number":6,"previsional_date":"2022-02-05","amount":"50.0","created_at":"2021-09-20T18:32:12.568+02:00","updated_at":"2021-09-20T18:32:12.568+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19992,"payment_schedule_id":3711,"number":7,"previsional_date":"2022-03-05","amount":"50.0","created_at":"2021-09-20T18:32:12.571+02:00","updated_at":"2021-09-20T18:32:12.571+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19993,"payment_schedule_id":3711,"number":8,"previsional_date":"2022-04-05","amount":"50.0","created_at":"2021-09-20T18:32:12.574+02:00","updated_at":"2021-09-20T18:32:12.574+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19994,"payment_schedule_id":3711,"number":9,"previsional_date":"2022-05-05","amount":"50.0","created_at":"2021-09-20T18:32:12.576+02:00","updated_at":"2021-09-20T18:32:12.576+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19995,"payment_schedule_id":3711,"number":10,"previsional_date":"2022-06-05","amount":"50.0","created_at":"2021-09-20T18:32:12.579+02:00","updated_at":"2021-09-20T18:32:12.579+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"}],"3712":[{"id":19998,"payment_schedule_id":3712,"number":2,"previsional_date":"2021-10-05","amount":"50.0","created_at":"2021-09-20T18:33:47.976+02:00","updated_at":"2021-09-20T18:33:47.976+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19999,"payment_schedule_id":3712,"number":3,"previsional_date":"2021-11-05","amount":"50.0","created_at":"2021-09-20T18:33:47.990+02:00","updated_at":"2021-09-20T18:33:47.990+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":20000,"payment_schedule_id":3712,"number":4,"previsional_date":"2021-12-05","amount":"50.0","created_at":"2021-09-20T18:33:48.004+02:00","updated_at":"2021-09-20T18:33:48.004+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":20001,"payment_schedule_id":3712,"number":5,"previsional_date":"2022-01-05","amount":"50.0","created_at":"2021-09-20T18:33:48.020+02:00","updated_at":"2021-09-20T18:33:48.020+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":20002,"payment_schedule_id":3712,"number":6,"previsional_date":"2022-02-05","amount":"50.0","created_at":"2021-09-20T18:33:48.034+02:00","updated_at":"2021-09-20T18:33:48.034+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":20003,"payment_schedule_id":3712,"number":7,"previsional_date":"2022-03-05","amount":"50.0","created_at":"2021-09-20T18:33:48.051+02:00","updated_at":"2021-09-20T18:33:48.051+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":20004,"payment_schedule_id":3712,"number":8,"previsional_date":"2022-04-05","amount":"50.0","created_at":"2021-09-20T18:33:48.064+02:00","updated_at":"2021-09-20T18:33:48.064+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":20005,"payment_schedule_id":3712,"number":9,"previsional_date":"2022-05-05","amount":"50.0","created_at":"2021-09-20T18:33:48.081+02:00","updated_at":"2021-09-20T18:33:48.081+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":20006,"payment_schedule_id":3712,"number":10,"previsional_date":"2022-06-05","amount":"50.0","created_at":"2021-09-20T18:33:48.097+02:00","updated_at":"2021-09-20T18:33:48.097+02:00","payment_method_id":0,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19996,"payment_schedule_id":3712,"number":0,"previsional_date":"2021-09-20","amount":"15.0","created_at":"2021-09-20T18:33:47.944+02:00","updated_at":"2021-09-20T18:34:11.242+02:00","payment_method_id":8,"due_payment_status_id":null,"location_id":null,"operation":"+"},{"id":19997,"payment_schedule_id":3712,"number":1,"previsional_date":"2021-09-20","amount":"50.0","created_at":"2021-09-20T18:33:47.960+02:00","updated_at":"2021-09-20T18:34:11.268+02:00","payment_method_id":1,"due_payment_status_id":null,"location_id":null,"operation":"+"}]}')
#
# DuePayment.transaction do
#   dues.each do |d|
#     next if d.count < 2
#
#     ps = PaymentSchedule.find d[0]
#
#     tab = d[1].map {|dp| DuePayment.new(dp)}
#
#     d[1].map do |dp|
#       next unless DuePayment.exists?(dp["id"])
#
#       tmp = DuePayment.find(dp["id"])
#       tmp.update(dp)
#       tmp.save
#     end
#
#     ps.due_payments << tab.filter{|dp| !DuePayment.exists?(dp.id)}
#
#     ps.save
#   end
# end
#
# # ---- payments ------
#
# pay = JSON.parse('{"17727":[],"17728":[],"17729":[],"17730":[],"18163":[],"18164":[],"18165":[],"18166":[],"17809":[{"id":15989,"payable_id":4950,"payment_method_id":6,"reception_date":null,"cashing_date":"2021-09-05","amount":"36.5","direction":null,"created_at":"2021-09-10T16:48:42.182+02:00","updated_at":"2021-09-10T16:48:42.182+02:00","due_payment_id":17809,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"36.5"}],"17810":[],"17811":[],"17812":[],"17813":[],"17814":[],"17815":[],"17816":[],"17817":[],"17818":[],"17808":[{"id":15990,"payable_id":4950,"payment_method_id":6,"reception_date":null,"cashing_date":"2021-09-05","amount":"15.0","direction":null,"created_at":"2021-09-10T16:48:42.195+02:00","updated_at":"2021-09-10T16:48:42.195+02:00","due_payment_id":17808,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"15.0"}],"18024":[],"18027":[],"18028":[],"18029":[],"18026":[],"18021":[],"18022":[],"18023":[],"18019":[{"id":15365,"payable_id":7053,"payment_method_id":8,"reception_date":null,"cashing_date":"2021-07-15","amount":"15.0","direction":null,"created_at":"2021-07-15T10:51:22.247+02:00","updated_at":"2021-07-15T10:51:22.247+02:00","due_payment_id":18019,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"15.0"}],"18025":[],"18020":[],"18078":[{"id":15367,"payable_id":6868,"payment_method_id":2,"reception_date":"2021-07-15T02:00:00.000+02:00","cashing_date":"2021-10-05","amount":"15.0","direction":null,"created_at":"2021-07-15T15:59:45.345+02:00","updated_at":"2021-07-21T15:15:20.288+02:00","due_payment_id":18078,"check_number":"7984916","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":true,"adjusted_amount":"15.0"}],"18079":[{"id":15368,"payable_id":6868,"payment_method_id":2,"reception_date":"2021-07-15T00:00:00.000+02:00","cashing_date":"2021-10-05","amount":"148.0","direction":null,"created_at":"2021-07-15T15:59:45.366+02:00","updated_at":"2021-07-15T16:03:25.893+02:00","due_payment_id":18079,"check_number":"7984916","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"148.0"}],"18080":[{"id":15369,"payable_id":6868,"payment_method_id":2,"reception_date":"2021-07-15T00:00:00.000+02:00","cashing_date":"2022-01-05","amount":"163.0","direction":null,"created_at":"2021-07-15T15:59:45.382+02:00","updated_at":"2021-07-15T16:03:34.211+02:00","due_payment_id":18080,"check_number":"7984917","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"163.0"}],"18081":[{"id":15370,"payable_id":6868,"payment_method_id":2,"reception_date":"2021-07-15T00:00:00.000+02:00","cashing_date":"2022-04-05","amount":"163.0","direction":null,"created_at":"2021-07-15T15:59:45.396+02:00","updated_at":"2021-07-15T16:03:47.720+02:00","due_payment_id":18081,"check_number":"7984918","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"163.0"}],"18088":[{"id":15377,"payable_id":7046,"payment_method_id":2,"reception_date":"2021-07-15T02:00:00.000+02:00","cashing_date":"2021-10-05","amount":"15.0","direction":null,"created_at":"2021-07-15T17:31:31.721+02:00","updated_at":"2021-07-21T15:15:04.687+02:00","due_payment_id":18088,"check_number":"9030937","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":true,"adjusted_amount":"15.0"}],"18089":[{"id":15378,"payable_id":7046,"payment_method_id":2,"reception_date":"2021-07-15T00:00:00.000+02:00","cashing_date":"2021-10-05","amount":"148.0","direction":null,"created_at":"2021-07-15T17:31:31.741+02:00","updated_at":"2021-07-15T17:32:34.361+02:00","due_payment_id":18089,"check_number":"9030937","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"148.0"}],"18090":[{"id":15379,"payable_id":7046,"payment_method_id":2,"reception_date":"2021-07-15T00:00:00.000+02:00","cashing_date":"2022-01-05","amount":"163.0","direction":null,"created_at":"2021-07-15T17:31:31.759+02:00","updated_at":"2021-07-15T17:32:41.120+02:00","due_payment_id":18090,"check_number":"9030938","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"163.0"}],"18091":[{"id":15380,"payable_id":7046,"payment_method_id":2,"reception_date":"2021-07-15T00:00:00.000+02:00","cashing_date":"2022-04-05","amount":"163.0","direction":null,"created_at":"2021-07-15T17:31:31.777+02:00","updated_at":"2021-07-15T17:32:49.366+02:00","due_payment_id":18091,"check_number":"9030939","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"163.0"}],"18185":[],"18183":[],"18186":[],"18187":[],"18188":[],"18189":[],"18190":[],"18191":[],"18184":[],"18192":[],"18193":[],"18194":[],"18815":[],"18816":[],"18817":[],"18818":[],"18819":[],"18820":[],"18821":[],"18822":[],"18823":[],"18824":[],"18825":[],"18867":[{"id":15808,"payable_id":5697,"payment_method_id":8,"reception_date":"2021-09-01T02:00:00.000+02:00","cashing_date":"2021-09-01","amount":"15.0","direction":null,"created_at":"2021-09-01T16:46:52.969+02:00","updated_at":"2021-09-01T16:46:52.969+02:00","due_payment_id":18867,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"15.0"}],"18868":[{"id":15809,"payable_id":5697,"payment_method_id":8,"reception_date":"2021-09-01T02:00:00.000+02:00","cashing_date":"2021-09-01","amount":"452.0","direction":null,"created_at":"2021-09-01T16:46:52.997+02:00","updated_at":"2021-09-01T16:46:52.997+02:00","due_payment_id":18868,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"452.0"}],"18871":[{"id":15814,"payable_id":6836,"payment_method_id":2,"reception_date":null,"cashing_date":"2021-10-05","amount":"345.0","direction":null,"created_at":"2021-09-01T17:27:41.523+02:00","updated_at":"2021-09-01T17:27:41.523+02:00","due_payment_id":18871,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"345.0"}],"18872":[{"id":15815,"payable_id":6836,"payment_method_id":2,"reception_date":null,"cashing_date":"2021-10-05","amount":"30.0","direction":null,"created_at":"2021-09-01T17:27:41.540+02:00","updated_at":"2021-09-01T17:37:39.727+02:00","due_payment_id":18872,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"30.0"}],"18885":[{"id":15827,"payable_id":6419,"payment_method_id":2,"reception_date":"2021-09-02T02:00:00.000+02:00","cashing_date":"2021-09-05","amount":"15.0","direction":null,"created_at":"2021-09-02T14:55:39.288+02:00","updated_at":"2021-09-02T14:57:14.666+02:00","due_payment_id":18885,"check_number":"5549117","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"15.0"}],"18886":[{"id":15828,"payable_id":6419,"payment_method_id":2,"reception_date":"2021-09-02T00:00:00.000+02:00","cashing_date":"2021-09-05","amount":"361.6","direction":null,"created_at":"2021-09-02T14:55:39.307+02:00","updated_at":"2021-09-02T14:57:19.691+02:00","due_payment_id":18886,"check_number":"5549117","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"361.6"}],"18887":[],"18924":[{"id":15854,"payable_id":6963,"payment_method_id":2,"reception_date":"2021-09-03T00:00:00.000+02:00","cashing_date":"2021-10-05","amount":"15.0","direction":null,"created_at":"2021-09-03T17:51:36.277+02:00","updated_at":"2021-09-03T17:51:51.940+02:00","due_payment_id":18924,"check_number":"1692215","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"15.0"}],"18925":[{"id":15855,"payable_id":6963,"payment_method_id":2,"reception_date":"2021-09-03T00:00:00.000+02:00","cashing_date":"2021-10-05","amount":"90.0","direction":null,"created_at":"2021-09-03T17:51:36.311+02:00","updated_at":"2021-09-03T17:52:02.368+02:00","due_payment_id":18925,"check_number":"1692215","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"90.0"}],"19542":[{"id":16178,"payable_id":7185,"payment_method_id":2,"reception_date":"2021-09-14T00:00:00.000+02:00","cashing_date":"2021-10-05","amount":"289.0","direction":null,"created_at":"2021-09-14T18:28:17.309+02:00","updated_at":"2021-09-14T18:31:23.668+02:00","due_payment_id":19542,"check_number":"1693545","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"289.0"}],"19540":[{"id":16176,"payable_id":7185,"payment_method_id":8,"reception_date":null,"cashing_date":"2021-09-14","amount":"15.0","direction":null,"created_at":"2021-09-14T18:28:17.253+02:00","updated_at":"2021-09-14T18:28:17.253+02:00","due_payment_id":19540,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"15.0"}],"19541":[{"id":16177,"payable_id":7185,"payment_method_id":2,"reception_date":"2021-09-14T00:00:00.000+02:00","cashing_date":"2021-10-05","amount":"163.0","direction":null,"created_at":"2021-09-14T18:28:17.279+02:00","updated_at":"2021-09-14T18:31:12.485+02:00","due_payment_id":19541,"check_number":"1693544","payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"163.0"}],"19986":[],"19987":[],"19988":[],"19989":[],"19990":[],"19991":[],"19992":[],"19993":[],"19994":[],"19995":[],"19998":[],"19999":[],"20000":[],"20001":[],"20002":[],"20003":[],"20004":[],"20005":[],"20006":[],"19996":[{"id":16321,"payable_id":7146,"payment_method_id":8,"reception_date":null,"cashing_date":"2021-09-20","amount":"15.0","direction":null,"created_at":"2021-09-20T18:34:11.216+02:00","updated_at":"2021-09-20T18:34:11.216+02:00","due_payment_id":19996,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"15.0"}],"19997":[{"id":16322,"payable_id":7146,"payment_method_id":1,"reception_date":null,"cashing_date":"2021-09-20","amount":"50.0","direction":null,"created_at":"2021-09-20T18:34:11.250+02:00","updated_at":"2021-09-20T18:34:11.250+02:00","due_payment_id":19997,"check_number":null,"payable_type":"User","check_issuer_name":null,"payment_status_id":null,"location_id":null,"operation":"+","check_status":false,"adjusted_amount":"50.0"}]}')
#
# Payment.transaction do
#   pay.each do |p|
#     next if p.count < 2
#
#     d = DuePayment.find p[0]
#
#     tab = p[1].map {|pa| Payment.new(pa)}
#
#     p[1].each {|pa| Payment.find(pa["id"]).update(pa) if Payment.exists?(pa["id"])}
#
#     d.payments << tab.filter {|pa| !Payment.exists?(pa.id) }
#
#     d.save
#   end
# end
